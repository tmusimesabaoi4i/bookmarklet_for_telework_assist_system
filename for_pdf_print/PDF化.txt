javascript:(function(){(async()=>{const P='A4',M='12mm',F='12pt',L=1.5,G=(s,r=document)=>{var e=r.querySelector(s);return e?(e.innerText||%27%27).trim():%27%27},y=G(%27#lappnum');if(!y){alert('lappnum が見つかりません');return;}const rows=Array.from(document.querySelectorAll('tr[data-content-id]'));if(!rows.length){alert('処理対象の行が見つかりません');return;}const Z=s=>(s||'noname').replace(/[\\/:*?"<>|]+/g,'_').replace(/\s+/g,' ').trim(),N=r=>{var n=r.querySelector('td.name');return n?(n.innerText||'').trim():'noname'},D=r=>{var d=r.querySelector('td.date');return d?(d.innerText||'').trim():'noname'},ID='__JPO_ZZZ_PICKER__';var prev=document.getElementById(ID);if(prev)prev.remove();const o=document.createElement('div');o.id=ID;o.setAttribute('role','dialog');o.setAttribute('aria-modal','true');var html="<div class='__panel' role='document' aria-labelledby='__modal_title'><div class='__hdr'><div class='__title' id='__modal_title'>印刷対象の ZZZ（name列）を選択</div><button class='__close' title='閉じる' aria-label='閉じる' type='button'>×</button></div><div class='__tools'><input type='text' class='__filter' placeholder='フィルタ（部分一致 / 正規表現:/pattern/i）' aria-label='フィルタ入力'><button class='__selall' type='button'>全選択</button><button class='__clear' type='button'>全解除</button></div><div class='__list' tabindex='0' aria-label='候補一覧'></div><div class='__ft'><span class='__count' aria-live='polite'></span><div class='__spacer'></div><button class='__cancel' type='button'>キャンセル</button><button class='__start' type='button'>選択を印刷開始</button></div></div><style>:root{color-scheme:light dark;}#${ID}{position:fixed;inset:0;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(10,25,61,.45);backdrop-filter:saturate(120%) blur(2px);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,'Noto Sans JP',sans-serif}#${ID} .__panel{width:min(900px,95vw);height:min(72vh,820px);background:#fff;color:#0f172a;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 24px 60px rgba(2,8,23,.30),0 8px 20px rgba(2,8,23,.18);display:flex;flex-direction:column;overflow:hidden;animation:__modalIn .16s ease-out}@keyframes __modalIn{from{opacity:0;transform:translateY(8px) scale(.98)}to{opacity:1;transform:none}}#${ID} .__hdr{display:flex;align-items:center;gap:8px;padding:12px 14px;background:linear-gradient(180deg,#eff6ff,#ffffff 60%);border-bottom:1px solid #e5e7eb}#${ID} .__title{font-weight:700;font-size:16px;letter-spacing:.2px}#${ID} .__close{margin-left:auto;border:1px solid #dbeafe;background:#ffffff;font-size:18px;line-height:1;border-radius:8px;cursor:pointer;padding:6px 10px}#${ID} .__tools{display:flex;gap:8px;align-items:center;padding:10px 14px;border-bottom:1px solid #e5e7eb;background:#f8fbff}#${ID} .__tools .__filter{flex:1;padding:10px 12px;border:1px solid #cfe0ff;border-radius:10px;font-size:14px;outline:none}#${ID} .__tools .__filter:focus{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.15)}#${ID} .__tools button,#${ID} .__ft button{padding:10px 12px;font-size:13px;border-radius:10px;cursor:pointer;border:1px solid #cfe0ff;background:#ffffff}#${ID} .__list{flex:1;overflow:auto;padding:8px 14px;background:#ffffff}#${ID} .__row{display:flex;align-items:center;gap:10px;padding:8px 6px;border-bottom:1px dashed #eef2ff}#${ID} .__row:hover{background:#f6faff}#${ID} .__row label{display:flex;align-items:center;gap:10px;cursor:pointer;width:100%}#${ID} .__row .__name{font-weight:600}#${ID} .__row .__meta{color:#5b6b8a;font-size:12px}#${ID} .__ft{display:flex;align-items:center;gap:10px;padding:12px 14px;border-top:1px solid #e5e7eb;background:#f8fbff}#${ID} .__start{background:#2563eb;color:#fff;border:1px solid #1d4ed8;font-weight:700}#${ID} .__ft button.__start{background:#2563eb;color:#ffffff;border:1px solid #1d4ed8;font-weight:700;display:inline-flex;align-items:center;justify-content:center;min-height:38px;min-width:11em;padding:10px 14px;white-space:nowrap}#${ID} .__start:hover{filter:brightness(1.05)}#${ID} .__cancel{background:#ffffff;color:#0f172a;border:1px solid #cfe0ff}#${ID} button:focus-visible{outline:3px solid rgba(37,99,235,.35);outline-offset:2px}@media (prefers-color-scheme:dark){#${ID}{background:rgba(2,6,23,.6)}#${ID} .__panel{background:#0b1220;color:#e5e7eb;border-color:#1e293b}#${ID} .__hdr{background:linear-gradient(180deg,#0b172f,#0b1220 70%);border-bottom-color:#1e293b}#${ID} .__tools,#${ID} .__ft{background:#0b1220;border-color:#1e293b}#${ID} .__tools .__filter{background:#0b1220;color:#e5e7eb;border-color:#334155}#${ID} .__tools button,#${ID} .__ft button{background:#0b1220;color:#e5e7eb;border-color:#334155}#${ID} .__ft button.__start{background:#3b82f6;border-color:#2563eb;color:#ffffff}#${ID} .__row{border-bottom-color:#172033}#${ID} .__row:hover{background:#0f172a}}</style>";o.innerHTML=html.split('${ID}').join(ID);const prevOverflow=document.body.style.overflow,prevPR=document.body.style.paddingRight,scw=window.innerWidth-document.documentElement.clientWidth;document.body.style.overflow='hidden';if(scw>0)document.body.style.paddingRight=scw+'px';const inertTargets=[].slice.call(document.body.children).filter(el=>el!==o);inertTargets.forEach(el=>{try{el.inert=true;}catch(_){ }el.setAttribute('aria-hidden','true');});document.body.appendChild(o);const p=o.querySelector('.__panel'),list=o.querySelector('.__list'),filter=o.querySelector('.__filter'),count=o.querySelector('.__count'),closeBtn=o.querySelector('.__close'),cancelBtn=o.querySelector('.__cancel'),startBtn=o.querySelector('.__start'),selAllBtn=o.querySelector('.__selall'),clearBtn=o.querySelector('.__clear');function closeModal(){o.removeEventListener('keydown',trapKey);o.remove();document.body.style.overflow=prevOverflow;document.body.style.paddingRight=prevPR;inertTargets.forEach(el=>{try{el.inert=false;}catch(_){ }el.removeAttribute('aria-hidden');});}const getFocusable=()=>Array.from(p.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])')).filter(el=>!el.disabled&&el.offsetParent!==null);function trapKey(e){if(e.key==='Tab'){const f=getFocusable();if(!f.length)return;const first=f[0],last=f[f.length-1];if(e.shiftKey&&document.activeElement===first){last.focus();e.preventDefault()}else if(!e.shiftKey&&document.activeElement===last){first.focus();e.preventDefault()}}else if(e.key==='Escape'){closeModal()}else if(e.key==='Enter'&&document.activeElement===filter){startBtn.click()}}o.addEventListener('keydown',trapKey);setTimeout(()=>filter.focus(),10);o.addEventListener('mousedown',e=>{if(e.target===o)closeModal()});const esc=s=>String(s).replace(/[&<>\"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])),items=rows.map((r,i)=>({idx:i,row:r,zzz:N(r),kkk:D(r),id:r.getAttribute('data-content-id')}));function render(f){let re=null;if(f&&f[0]=='/'&&f.lastIndexOf('/')>0){const last=f.lastIndexOf('/'),body=f.slice(1,last),flags=f.slice(last+1);try{re=new RegExp(body,flags)}catch(_){}}const q=(f||'').toLowerCase();list.innerHTML='';let shown=0;for(const it of items){const text=(it.zzz+it.kkk).toLowerCase();let hit=true;if(re)hit=re.test(text);else if(q)hit=text.includes(q);if(!hit)continue;const id='__pick_'+it.idx,def=['請求の範囲','明細書','図面','手続補正書','意見書','拒絶理由通知書','審判請求書','補正の却下','拒絶査定'].some(k=>(it.zzz||'').toLowerCase().indexOf(String(k).toLowerCase())>-1);const el=document.createElement('div');el.className='__row';el.innerHTML="<label for='"+id+"'><input type='checkbox' id='"+id+"' data-idx='"+it.idx+"' "+(def?'checked':'')+"><span class='__name'>"+esc(it.zzz)+"</span><span class='__meta'>（date:"+esc(it.kkk)+"/ id:"+esc(it.id||'')+"）</span></label>";list.appendChild(el);shown++}count.textContent='表示:'+shown+'/ 全体:'+items.length;}render();selAllBtn.onclick=()=>{list.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=true)};clearBtn.onclick=()=>{list.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false)};filter.oninput=()=>render(filter.value.trim());closeBtn.onclick=cancelBtn.onclick=closeModal;startBtn.onclick=()=>{const idxs=Array.from(list.querySelectorAll('input[type=checkbox]:checked')).map(cb=>Number(cb.getAttribute('data-idx')));if(!idxs.length){alert('少なくとも1件選択してください');return;}const picked=idxs.map(i=>items.find(it=>it.idx===i)).filter(Boolean);closeModal();runPrint(picked)};const buildHTML=(t,b,h)=>'<!doctype html><html><head><meta charset="utf-8"><title>'+t+'</title><base href="'+b+'"><style>:root{color-scheme:light dark;}body{font-size:'+F+';line-height:'+L+';}@page{size:'+P+';margin:'+M+';}@media print{a[href]::after{content:"";}}</style></head><body>'+h+'</body></html>',ready=win=>new Promise(res=>{const tick=()=>{try{if(win.document&&win.document.readyState==='complete'){res();return;}}catch(_){ }setTimeout(tick,80)};tick()});async function runPrint(ts){let i=0;if(!window.__JPO_VIEWER||window.__JPO_VIEWER.closed){window.__JPO_VIEWER=window.open('','JPO_VIEWER');if(!window.__JPO_VIEWER){alert('ポップアップがブロックされています。許可してください。');return;}}const v=window.__JPO_VIEWER;async function next(){if(i>=ts.length){alert('すべての処理が完了しました');return;}const it=ts[i++];const a=it.row.querySelector('a[href*="/core/docs/jsv/content/"]');const base=(function(){if(a){try{return new URL(a.getAttribute('href'),location.href).toString().replace(/(#.*)?$/,'')}catch(_){}}try{return new URL('/core/docs/jsv/content/'+it.id+'/',location.origin).toString()}catch(_){return 'https://gem.prototype.jpo.go.jp/core/docs/jsv/content/'+it.id+'/'}})();try{const res=await fetch(base,{credentials:'include'});if(!res.ok)throw new Error('HTTP '+res.status);const html=await res.text(),doc=new DOMParser().parseFromString(html,'text/html'),body=doc.body?doc.body.innerHTML:html,title=Z(y)+'_'+Z(it.kkk)+'_'+Z(it.zzz);v.document.open();v.document.write(buildHTML(title,base,body));v.document.close();await ready(v);v.focus();v.print();alert('次へ進むには OK を押してください');next()}catch(e){console.error('取得失敗:',base,e);alert('取得失敗:'+it.zzz+'（次へ進みます）');next()}}next()} })();})()